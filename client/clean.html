<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stackr Finance - CLEAN (Firebase-Free)</title>
  <meta name="description" content="Stackr Finance helps you track income, plan budgets with 40/30/30 splits, set financial goals, and get AI-powered financial advice." />
  <link rel="icon" type="image/svg+xml" href="/stackr-logo.svg" />
  <meta name="theme-color" content="#4F46E5" />
  <!-- Allow scripts to run with permissive CSP -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://replit.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://api.stripe.com https://fonts.googleapis.com https://api.plaid.com; font-src 'self' https://fonts.gstatic.com; frame-src 'self' https://js.stripe.com; object-src 'none';" />
  
  <!-- Enhanced debugging directly in HTML -->
  <style>
    #debug-info {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #f8f9fa;
      color: #333;
      font-family: monospace;
      padding: 10px;
      border-bottom: 1px solid #dee2e6;
      z-index: 9999;
      max-height: 200px;
      overflow-y: auto;
    }
    .debug-msg {
      margin: 5px 0;
      padding: 5px;
      border-bottom: 1px solid #eee;
    }
    .debug-error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
  
  <script>
    // Create debug info panel
    window.addEventListener('DOMContentLoaded', () => {
      const debugPanel = document.createElement('div');
      debugPanel.id = 'debug-info';
      debugPanel.innerHTML = '<h3>Firebase-Free Debug Panel</h3>';
      document.body.prepend(debugPanel);
      
      // Add debug logging function
      window.debugLog = function(msg, isError) {
        console.log(msg);
        const msgEl = document.createElement('div');
        msgEl.className = isError ? 'debug-msg debug-error' : 'debug-msg';
        msgEl.textContent = msg;
        debugPanel.appendChild(msgEl);
      };
      
      window.debugLog("[CLEAN] Firebase-free app loading...");
      
      // Prevent any Firebase from loading by providing mock implementation
      window.firebase = {
        // Complete mock of Firebase with projectId
        initializeApp: function(config) {
          window.debugLog("Mock Firebase initializeApp called with: " + (config ? JSON.stringify(config) : "default"));
          return {
            name: 'mock-firebase-app',
            options: { 
              projectId: 'mock-firebase-project-id',
              apiKey: 'mock-api-key',
              authDomain: 'mock-auth-domain.example.com'
            }
          };
        },
        apps: [{
          name: 'mock-firebase-app',
          options: { 
            projectId: 'mock-firebase-project-id',
            apiKey: 'mock-api-key',
            authDomain: 'mock-auth-domain.example.com'
          }
        }],
        auth: function() {
          window.debugLog("Mock Firebase auth() called");
          return {
            signInWithEmailAndPassword: () => Promise.resolve({ user: null }),
            createUserWithEmailAndPassword: () => Promise.resolve({ user: null }),
            signOut: () => Promise.resolve(),
            onAuthStateChanged: (cb) => { cb(null); return () => {}; },
            setPersistence: () => Promise.resolve(),
            currentUser: null
          };
        },
        setPersistence: () => Promise.resolve(),
        browserLocalPersistence: 'LOCAL',
        browserSessionPersistence: 'SESSION',
        GoogleAuthProvider: function() { return {}; }
      };
      
      window.firebaseui = null;
      
      // Try to catch script loading errors
      window.addEventListener('error', function(e) {
        window.debugLog('Script Error: ' + e.message, true);
      });
    });
  </script>
</head>
<body>
  <div id="root"></div>
  
  <!-- Load our Firebase-free entry point -->
  <script type="module">
    window.debugLog("Loading Firebase-free entry point...");
    
    try {
      // Import our no-firebase entry instead of regular entry point
      import('/src/no-firebase-entry.tsx')
        .then(() => {
          window.debugLog("Firebase-free entry point loaded successfully");
        })
        .catch(err => {
          window.debugLog("Error loading Firebase-free entry: " + err.message, true);
          
          // We need to use a different syntax for React imports with dynamic imports
          window.debugLog("Loading fallback minimal React app...");
          
          Promise.all([
            import('react'),
            import('react-dom/client')
          ]).then(([React, ReactDOM]) => {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(
              React.createElement('div', { style: { padding: '20px', marginTop: '220px' } },
                React.createElement('h1', null, 'Stackr Finance - Clean Mode'),
                React.createElement('p', null, 'Error loading Firebase-free implementation'),
                React.createElement('p', null, 'Check debug panel for details.')
              )
            );
            window.debugLog("Fallback React app rendered successfully");
          }).catch(importErr => {
            window.debugLog("Error importing React: " + importErr.message, true);
          });
        });
    } catch (err) {
      window.debugLog("Fatal error: " + err.message, true);
    }
  </script>

  <!-- Replit badge -->
  <script
    type="text/javascript"
    src="https://replit.com/public/js/replit-badge-v3.js"
  ></script>
</body>
</html>