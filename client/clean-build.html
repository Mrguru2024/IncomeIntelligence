<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=yes, viewport-fit=cover"
    />
    <title>Stackr Finance - Service Provider Finance Tool</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <script>
      // Block Firebase and Sanity imports completely
      window.FIREBASE_IMPORTS_BLOCKED = true;
      
      // Create empty mocks for Firebase and Sanity
      window.firebase = {};
      window.sanity = {};
      
      // Track initialization attempts
      window.firebaseInitAttempts = 0;
      window.sanityInitAttempts = 0;
      
      // Wrap console log to identify Firebase issues
      const originalConsoleError = console.error;
      console.error = function(...args) {
        if (args[0] && typeof args[0] === 'string' && 
            (args[0].includes('firebase') || args[0].includes('sanity'))) {
          console.warn('Blocked error from Firebase/Sanity:', args[0]);
          return;
        }
        return originalConsoleError.apply(this, args);
      };
    </script>
  </head>
  <body>
    <div id="root"></div>
    <div id="error-display" style="display: none; padding: 20px; color: red; font-family: system-ui, sans-serif;">
      <h2>Application Error</h2>
      <p>Sorry, something went wrong while loading the application.</p>
      <pre id="error-message"></pre>
    </div>
    
    <!-- Use direct script loading -->
    <script>
      // Direct JavaScript injection to ensure Vite properly processes our entry
      document.addEventListener('DOMContentLoaded', () => {
        console.log('Loading Firebase-free application...');
        
        const root = document.getElementById('root');
        if (root) {
          // Display a loading message
          root.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh;"><div style="text-align: center;"><div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; margin: 0 auto 15px; animation: spin 2s linear infinite;"></div><p>Loading Stackr...</p></div></div>';
        }
        
        // We use a dynamic import so we can catch any errors
        import('./src/firebase-free-entry.tsx')
          .then(() => {
            console.log('Firebase-free application loaded successfully');
          })
          .catch((error) => {
            console.error('Failed to load Firebase-free application:', error);
            
            // Display the error to the user
            const errorDisplay = document.getElementById('error-display');
            const errorMessage = document.getElementById('error-message');
            
            if (errorDisplay && errorMessage) {
              errorDisplay.style.display = 'block';
              errorMessage.textContent = error.message || 'Unknown error';
            }
            
            // Clear the loading indicator
            if (root) {
              root.innerHTML = '';
            }
          });
      });
      
      // Add spinning animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>