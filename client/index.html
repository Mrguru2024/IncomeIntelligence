<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=yes, viewport-fit=cover, target-densitydpi=device-dpi"
    />
    <title>Stackr - Personal Finance</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <style>
      /* Base styles */
      :root {
        --primary: #4f46e5;
        --primary-foreground: #ffffff;
        --background: #f8fafc;
        --foreground: #0f172a;
        --card: #ffffff;
        --card-foreground: #1e293b;
        --border: #e2e8f0;
        --input: #e2e8f0;
        --ring: #4f46e5;
        --radius: 0.5rem;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.5;
      }
      
      #root {
        min-height: 100vh;
      }
      
      .error-container {
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
      }
      
      .error-heading {
        color: #e11d48;
        font-size: 1.875rem;
        margin-bottom: 1rem;
      }
      
      .error-message {
        margin-bottom: 2rem;
      }
      
      .error-code {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 0.375rem;
        font-family: monospace;
        text-align: left;
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
    </style>
    
    <!-- Firebase & Sanity Blocking System -->
    <script>
      // Disable problematic modules before any code loads
      window.DISABLE_FIREBASE = true;
      window.DISABLE_SANITY = true;
      window.__FIREBASE_DEFAULTS__ = {};
      
      // Create extremely aggressive mock implementations
      window.firebase = new Proxy({}, {
        get: function(target, prop) {
          console.log(`[BLOCKED] Firebase access attempt: ${String(prop)}`);
          return typeof prop === 'string' ? 
            function() { return new Proxy({}, { get: () => function() { return {}; } }); } : 
            {};
        }
      });
      
      // Add projectId to prevent the specific error we're seeing
      window.firebaseConfig = {
        projectId: 'mock-project-id',
        apiKey: 'mock-api-key',
        authDomain: 'mock-auth-domain.firebaseapp.com',
        databaseURL: 'https://mock-db.firebaseio.com',
        storageBucket: 'mock-storage.appspot.com',
        messagingSenderId: '000000000000',
        appId: '1:000000000000:web:0000000000000000000000'
      };
      
      // Mock the entire firebase namespace
      window.firebase = {
        initializeApp: function() { 
          console.log("[Firebase Mock] initializeApp called with mocked implementation");
          return {
            auth: function() { return {}; },
            firestore: function() { return {}; },
            app: function() { return {}; }
          }; 
        },
        auth: function() { 
          return {
            onAuthStateChanged: function(callback) { return function() {}; },
            signInWithEmailAndPassword: function() { return Promise.resolve({}); },
            createUserWithEmailAndPassword: function() { return Promise.resolve({}); },
            signOut: function() { return Promise.resolve({}); },
            currentUser: null
          }; 
        },
        firestore: function() { return {}; },
        app: function() { return {}; }
      };
      
      // Override imports to block Firebase/Sanity
      const originalDynamicImport = window.dynamicImport || (path => import(path));
      window.dynamicImport = function(path) {
        if (typeof path === 'string' && (path.includes('firebase') || path.includes('sanity'))) {
          console.log('[BLOCKED DYNAMIC IMPORT]', path);
          return Promise.resolve({ 
            default: {
              initializeApp: () => ({
                projectId: 'mock-project-id'
              }),
              getAuth: () => ({ currentUser: null }),
              createClient: () => ({})
            }, 
            initializeApp: () => ({
              projectId: 'mock-project-id'
            }),
            getAuth: () => ({ currentUser: null }),
            createClient: () => ({})
          });
        }
        return originalDynamicImport(path);
      };
      
      // Inject the config property
      if (typeof module !== 'undefined') {
        module.exports = {
          firebase: window.firebase,
          projectId: 'mock-project-id'
        };
      }

      // Add Firebase persistence message to show our block worked
      console.log("Firebase persistence set");
    </script>
  </head>
  <body>
    <div id="root">
      <!-- Fallback content if JavaScript fails to load -->
      <div class="error-container">
        <h2 class="error-heading">Loading Stackr...</h2>
        <p class="error-message">Please wait while we set up your financial dashboard.</p>
      </div>
    </div>
    
    <!-- Clean entry point with no problematic dependencies -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Replit badge -->
    <script
      type="text/javascript"
      src="https://replit.com/public/js/replit-badge-v3.js"
    ></script>
  </body>
</html>
