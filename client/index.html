<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=yes, viewport-fit=cover, target-densitydpi=device-dpi"
    />
    <title>Stackr - Personal Finance</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <style>
      /* Base styles */
      :root {
        --primary: #4f46e5;
        --primary-foreground: #ffffff;
        --background: #f8fafc;
        --foreground: #0f172a;
        --card: #ffffff;
        --card-foreground: #1e293b;
        --border: #e2e8f0;
        --input: #e2e8f0;
        --ring: #4f46e5;
        --radius: 0.5rem;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.5;
      }
      
      #root {
        min-height: 100vh;
      }
      
      .error-container {
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
      }
      
      .error-heading {
        color: #e11d48;
        font-size: 1.875rem;
        margin-bottom: 1rem;
      }
      
      .error-message {
        margin-bottom: 2rem;
      }
      
      .error-code {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 0.375rem;
        font-family: monospace;
        text-align: left;
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
    </style>
    
    <!-- Firebase & Sanity Blocking System (Improved) -->
    <script>
      // Create better mocks with proper configuration to avoid errors
      window.FIREBASE_DISABLED = true;
      window.SANITY_DISABLED = true;
      
      // Configure sanity client with a projectId to prevent the error
      window.SANITY_CONFIG = {
        projectId: 'mock-project-id',
        dataset: 'production',
        apiVersion: '2023-11-01',
        useCdn: true
      };
      
      // Mock firebase completely
      window.firebase = {
        initializeApp: function() { 
          console.log("[Firebase Mock] initializeApp called");
          return {
            options: {
              projectId: 'mock-project-id',
              apiKey: 'mock-api-key'
            },
            auth: function() { 
              return {
                onAuthStateChanged: function(callback) { 
                  // Immediately call the callback with null to simulate logged out state
                  setTimeout(() => callback(null), 0);
                  return function() {}; 
                },
                signInWithEmailAndPassword: function() { 
                  return Promise.resolve({
                    user: {
                      uid: 'mock-user-id',
                      email: 'user@example.com',
                      displayName: 'Test User'
                    }
                  }); 
                },
                createUserWithEmailAndPassword: function() { 
                  return Promise.resolve({
                    user: {
                      uid: 'mock-user-id',
                      email: 'newuser@example.com'
                    }
                  }); 
                },
                signOut: function() { return Promise.resolve(); },
                currentUser: null,
                setPersistence: function() { return Promise.resolve(); }
              }; 
            },
            firestore: function() { return {
              collection: () => ({
                doc: () => ({
                  get: () => Promise.resolve({
                    exists: false,
                    data: () => null
                  }),
                  set: () => Promise.resolve()
                }),
                add: () => Promise.resolve({ id: 'mock-doc-id' })
              })
            }; }
          }; 
        },
        auth: {
          GoogleAuthProvider: function() { return {}; },
          signInWithRedirect: function() {},
          getRedirectResult: function() { return Promise.resolve(null); }
        },
        app: function() { return {}; },
        firestore: { 
          Timestamp: { 
            now: () => ({ toDate: () => new Date() }),
            fromDate: (date) => ({ toDate: () => date })
          }
        }
      };
      
      // For browser environment
      window.__FIREBASE_DEFAULTS__ = {
        config: {
          projectId: 'mock-project-id',
          apiKey: 'mock-api-key',
          authDomain: 'mock-auth-domain.firebaseapp.com'
        }
      };
      
      // For modules that might try to access firebase
      if (typeof module !== 'undefined') {
        module.exports = {
          firebase: window.firebase,
          initializeApp: window.firebase.initializeApp,
          getAuth: () => window.firebase.auth(),
          getFirestore: () => window.firebase.firestore(),
          default: window.firebase
        };
      }

      // Log that our blocking system is active
      console.log("Firebase persistence set");
    </script>
  </head>
  <body>
    <div id="root">
      <!-- Fallback content if JavaScript fails to load -->
      <div class="error-container">
        <h2 class="error-heading">Loading Stackr...</h2>
        <p class="error-message">Please wait while we set up your financial dashboard.</p>
      </div>
    </div>
    
    <!-- Super clean entry point with minimal dependencies -->
    <script type="module" src="/src/clean-entry.tsx"></script>
    
    <!-- Replit badge -->
    <script
      type="text/javascript"
      src="https://replit.com/public/js/replit-badge-v3.js"
    ></script>
  </body>
</html>
