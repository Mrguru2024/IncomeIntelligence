<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=yes, viewport-fit=cover, target-densitydpi=device-dpi"
    />
    <title>Stackr - Personal Finance</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <style>
      /* Base styles */
      :root {
        --primary: #4f46e5;
        --primary-foreground: #ffffff;
        --background: #f8fafc;
        --foreground: #0f172a;
        --card: #ffffff;
        --card-foreground: #1e293b;
        --border: #e2e8f0;
        --input: #e2e8f0;
        --ring: #4f46e5;
        --radius: 0.5rem;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--background);
        color: var(--foreground);
        line-height: 1.5;
      }
      
      #root {
        min-height: 100vh;
      }
      
      .error-container {
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
        text-align: center;
      }
      
      .error-heading {
        color: #e11d48;
        font-size: 1.875rem;
        margin-bottom: 1rem;
      }
      
      .error-message {
        margin-bottom: 2rem;
      }
      
      .error-code {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 0.375rem;
        font-family: monospace;
        text-align: left;
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
    </style>
    
    <!-- Advanced Dependency Interception System -->
    <script>
      console.log("Initializing advanced dependency interception system...");
      
      // --- CRITICAL: Prevent any direct imports of Firebase or Sanity ---
      // This creates a global interception layer that prevents modules from loading
      window.__SANITY_CLIENT__ = {
        projectId: 'stackr-demo-project',
        dataset: 'production',
        apiVersion: '2023-04-01',
        useCdn: true
      };
      
      // Global configuration with required fields to prevent errors
      window.__FIREBASE_CONFIG__ = {
        projectId: 'stackr-demo-project',
        apiKey: 'AIzaSy-mock-key-zMsxHsGlj4',
        authDomain: 'stackr-demo-project.firebaseapp.com'
      };
      
      // Handle AMD/UMD module loading
      window.define = window.define || function(name, deps, callback) {
        // Intercept any attempts to load Firebase or Sanity
        if (typeof name === 'string' && 
            (name.includes('firebase') || name.includes('sanity'))) {
          console.log(`[Interceptor] Blocked module: ${name}`);
          return null;
        }
        
        // Let other modules load normally
        if (typeof callback === 'function') {
          callback();
        }
      };
      
      // Set CommonJS Module.exports for script tags
      window.module = window.module || { 
        exports: {}
      };
      
      // Compatibility with more module systems
      window.__FIREBASE_DEFAULTS__ = {
        config: window.__FIREBASE_CONFIG__
      };
      
      console.log("Dependency interception system initialized successfully");
      
      // Force native Firebase to be mocked even if it tries to load
      Object.defineProperty(window, 'firebase', {
        value: {
          initializeApp: () => ({
            auth: () => ({
              onAuthStateChanged: (cb) => { setTimeout(() => cb(null), 10); return () => {}; },
              signOut: () => Promise.resolve()
            }),
            options: window.__FIREBASE_CONFIG__
          })
        },
        writable: false,
        configurable: false
      });
    </script>
  </head>
  <body>
    <div id="root">
      <!-- Fallback content if JavaScript fails to load -->
      <div class="error-container">
        <h2 class="error-heading">Loading Stackr...</h2>
        <p class="error-message">Please wait while we set up your financial dashboard.</p>
      </div>
    </div>
    
    <!-- Use main.tsx for dynamic app -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Replit badge -->
    <script
      type="text/javascript"
      src="https://replit.com/public/js/replit-badge-v3.js"
    ></script>
  </body>
</html>
