<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quote Generator | Stackr</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/green/public/css/styles.css">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      padding: 0;
      margin: 0;
      color: #333;
      background-color: #f9fafb;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .quote-generator-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .header {
      background-color: #4F46E5;
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .header h1 {
      margin: 0;
      font-size: 1.75rem;
    }
    
    .header p {
      margin-top: 8px;
      opacity: 0.8;
    }
    
    .main-content {
      display: flex;
      gap: 20px;
    }
    
    @media (max-width: 768px) {
      .main-content {
        flex-direction: column;
      }
    }
    
    .quote-form-container {
      flex: 1;
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .results-container {
      flex: 1;
      display: none;
    }
    
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .card-header {
      padding: 15px 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.875rem;
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 0.875rem;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #4F46E5;
      box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
    }
    
    .btn {
      display: inline-block;
      padding: 10px 16px;
      background-color: #4F46E5;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      font-size: 0.875rem;
      transition: background-color 0.2s;
    }
    
    .btn:hover {
      background-color: #4338ca;
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid #4F46E5;
      color: #4F46E5;
    }
    
    .btn-outline:hover {
      background-color: rgba(79, 70, 229, 0.1);
    }
    
    .quote-card {
      margin-bottom: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .quote-card-header {
      padding: 15px;
      border-bottom: 1px solid #e5e7eb;
      background-color: #f9fafb;
    }
    
    .quote-card-body {
      padding: 15px;
    }
    
    .quote-card-footer {
      padding: 15px;
      border-top: 1px solid #e5e7eb;
      background-color: #f9fafb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .quote-actions {
      display: flex;
      gap: 10px;
    }
    
    .price-tag {
      font-size: 1.5rem;
      font-weight: 700;
      color: #4F46E5;
    }
    
    .feature-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    
    .feature-list li {
      padding: 8px 0;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid #f3f4f6;
    }
    
    .feature-list li:last-child {
      border-bottom: none;
    }
    
    .feature-list i {
      color: #10b981;
    }
    
    .tier-basic .quote-card-header {
      background-color: #f3f4f6;
    }
    
    .tier-standard .quote-card-header {
      background-color: #eef2ff;
    }
    
    .tier-premium .quote-card-header {
      background-color: #ede9fe;
    }
    
    .small-text {
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    .tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
      color: white;
      background-color: #4F46E5;
    }
    
    .tag-success {
      background-color: #10b981;
    }
    
    .tag-warning {
      background-color: #f59e0b;
    }
    
    .breakdown-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    
    .breakdown-table th,
    .breakdown-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .breakdown-table th {
      font-weight: 500;
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    .features-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .features-table td {
      padding: 8px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .features-table td:last-child {
      text-align: right;
    }
    
    .detailed-breakdown-toggle {
      cursor: pointer;
      font-size: 0.875rem;
      color: #4F46E5;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .detailed-breakdown {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background-color: #f9fafb;
      border-radius: 6px;
    }
    
    .spinner {
      border: 3px solid rgba(0, 0, 0, 0.1);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border-top-color: #4F46E5;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Responsive adjustments */
    @media (max-width: 640px) {
      .quote-card-footer {
        flex-direction: column;
        gap: 10px;
        align-items: start;
      }
      
      .quote-actions {
        width: 100%;
        justify-content: space-between;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="sidebar-container"></div>
  
  <div class="container">
    <div id="quote-generator-container" class="quote-generator-container">
      <div class="header">
        <h1>Professional Quote Generator</h1>
        <p>Create detailed, accurate quotes for your services</p>
      </div>
      
      <div class="main-content">
        <div class="quote-form-container">
          <h2>Quote Details</h2>
          <form class="quote-form">
            <div class="form-group">
              <label for="job-type">Service Type</label>
              <select id="job-type" class="form-control" required>
                <option value="">Select a service type</option>
                <optgroup label="Home Services">
                  <option value="locksmith">Locksmith</option>
                  <option value="plumber">Plumber</option>
                  <option value="electrician">Electrician</option>
                  <option value="carpenter">Carpenter</option>
                  <option value="hvac">HVAC Technician</option>
                  <option value="painter">Painter</option>
                  <option value="general_contractor">General Contractor</option>
                  <option value="landscaper">Landscaper</option>
                </optgroup>
                <optgroup label="Automotive Services">
                  <option value="automotive_repair">Automotive Repair</option>
                </optgroup>
                <optgroup label="Electronics Repair">
                  <option value="electronic_repair">Electronic Repair</option>
                  <option value="cellphone_repair">Cellphone Repair</option>
                  <option value="computer_repair">Computer Repair</option>
                  <option value="tv_repair">TV Repair</option>
                  <option value="appliance_repair">Appliance Repair</option>
                </optgroup>
                <optgroup label="Beauty Services">
                  <option value="hair_stylist">Hair Stylist</option>
                  <option value="barber">Barber</option>
                  <option value="makeup_artist">Makeup Artist</option>
                  <option value="nail_technician">Nail Technician</option>
                  <option value="esthetician">Esthetician</option>
                </optgroup>
                <optgroup label="Professional Services">
                  <option value="photographer">Photographer</option>
                  <option value="videographer">Videographer</option>
                  <option value="web_developer">Web Developer</option>
                  <option value="graphic_designer">Graphic Designer</option>
                  <option value="consultant">Consultant</option>
                </optgroup>
              </select>
            </div>
            
            <div class="form-group" id="job-subtype-container" style="display: none;">
              <label for="job-subtype">Specific Service</label>
              <select id="job-subtype" class="form-control">
                <option value="">Select specific service</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="auto-address-input">Location</label>
              <input type="text" id="auto-address-input" class="form-control" placeholder="Enter service location" required>
            </div>
            
            <div class="form-group">
              <label for="experience-level">Experience Level</label>
              <select id="experience-level" class="form-control" required>
                <option value="">Select experience level</option>
                <option value="junior">Junior (0-2 years)</option>
                <option value="intermediate" selected>Intermediate (3-5 years)</option>
                <option value="senior">Senior (6-10 years)</option>
                <option value="expert">Expert (10+ years)</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="labor-hours">Estimated Labor Hours</label>
              <input type="number" id="labor-hours" class="form-control" placeholder="Estimated time required" min="0.5" step="0.5" value="2" required>
            </div>
            
            <div class="form-group" id="quantity-container">
              <label for="quantity">Quantity</label>
              <input type="number" id="quantity" class="form-control" placeholder="Number of items/services" min="1" value="1" required>
            </div>
            
            <div class="form-group">
              <label for="materials-cost">Materials Cost ($)</label>
              <input type="number" id="materials-cost" class="form-control" placeholder="Cost of materials" min="0" step="0.01" value="50" required>
            </div>
            
            <div class="form-group">
              <label for="target-margin">Target Margin (%)</label>
              <input type="number" id="target-margin" class="form-control" placeholder="Target profit margin" min="0" max="100" value="30" required>
            </div>
            
            <div class="form-check form-group">
              <input type="checkbox" id="emergency" class="form-check-input">
              <label for="emergency" class="form-check-label">Emergency Service (after hours/weekend)</label>
            </div>
            
            <button type="submit" class="btn">Generate Quote</button>
          </form>
        </div>
        
        <div class="results-container">
          <!-- Quote results will be displayed here -->
          <h2>Quote Results</h2>
          <p>Your quotes will appear here after generation</p>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  
  <!-- Create global callback for Google Maps loading -->
  <script>
    // Global flag to track Google Maps loading
    window.googleMapsLoaded = false;
    
    // Callback function that will be called when Maps loads
    window.initGoogleMaps = function() {
      console.log('Google Maps API has been successfully loaded!');
      window.googleMapsLoaded = true;
      
      // If the quote generator has already been rendered, initialize Maps
      if (window.initializeAddressAutocomplete) {
        window.initializeAddressAutocomplete();
      }
    };
    
    // Function to fetch Google Maps API key from our server
    async function loadGoogleMapsWithKey() {
      try {
        console.log('Fetching Google Maps API key from server...');
        const response = await fetch('/api/google-maps-key');
        const data = await response.json();
        
        if (data && data.key) {
          console.log('Successfully retrieved API key, loading Google Maps...');
          
          // Create the script element
          const script = document.createElement('script');
          script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places&callback=initGoogleMaps`;
          script.async = true;
          script.defer = true;
          
          // Add error handler
          script.onerror = function() {
            console.error('Failed to load Google Maps API. Loading fallback...');
            loadFallbackMaps();
          };
          
          // Append to document
          document.head.appendChild(script);
        } else {
          console.error('Invalid API key response, using fallback');
          loadFallbackMaps();
        }
      } catch (error) {
        console.error('Error fetching Google Maps API key:', error);
        loadFallbackMaps();
      }
    }
    
    // Function to load fallback Maps implementation
    function loadFallbackMaps() {
      console.log('Loading fallback Maps implementation...');
      
      fetch('/api/google-maps-fallback')
        .then(response => response.text())
        .then(scriptText => {
          // Create script element and execute the code
          const script = document.createElement('script');
          script.textContent = scriptText;
          document.head.appendChild(script);
          
          console.log('Fallback Maps loaded');
          
          // Set the global flag to indicate Maps is ready (but using fallback)
          window.googleMapsLoaded = true;
          
          // If the autocomplete initialization function exists, call it
          if (window.initializeAddressAutocomplete) {
            console.log('Calling initializeAddressAutocomplete from fallback');
            window.initializeAddressAutocomplete();
          }
        })
        .catch(error => {
          console.error('Failed to load Maps fallback:', error);
        });
    }
    
    // Export createToast to global window object
    if (typeof window.createToast !== 'function') {
      window.createToast = function(message, type = 'info', duration = 3000) {
        console.log('Using global createToast function:', message, type);
        
        // Initialize container if needed
        let toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
          toastContainer = document.createElement('div');
          toastContainer.id = 'toast-container';
          toastContainer.style.position = 'fixed';
          toastContainer.style.bottom = '20px';
          toastContainer.style.right = '20px';
          toastContainer.style.zIndex = '9999';
          document.body.appendChild(toastContainer);
        }
        
        // Create toast element
        const toast = document.createElement('div');
        
        // Set colors based on type
        switch (type) {
          case 'success':
            toast.style.backgroundColor = '#e9f7ef';
            toast.style.border = '1px solid #4CAF50';
            toast.style.color = '#2e7d32';
            break;
          case 'error':
            toast.style.backgroundColor = '#FFEBEE';
            toast.style.border = '1px solid #F44336';
            toast.style.color = '#c62828';
            break;
          case 'warning':
            toast.style.backgroundColor = '#FFF8E1';
            toast.style.border = '1px solid #FFC107';
            toast.style.color = '#ff8f00';
            break;
          default: // info
            toast.style.backgroundColor = '#E3F2FD';
            toast.style.border = '1px solid #2196F3';
            toast.style.color = '#0277bd';
        }
        
        toast.style.padding = '12px 16px';
        toast.style.borderRadius = '6px';
        toast.style.marginBottom = '8px';
        toast.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        toast.style.display = 'flex';
        toast.style.alignItems = 'center';
        toast.style.justifyContent = 'space-between';
        toast.style.minWidth = '300px';
        toast.style.maxWidth = '400px';
        toast.style.animation = 'fadeIn 0.3s';
        
        // Add message
        const messageElement = document.createElement('span');
        messageElement.textContent = message;
        
        // Add close button
        const closeButton = document.createElement('button');
        closeButton.innerHTML = '&times;';
        closeButton.style.background = 'transparent';
        closeButton.style.border = 'none';
        closeButton.style.fontSize = '18px';
        closeButton.style.marginLeft = '8px';
        closeButton.style.cursor = 'pointer';
        closeButton.style.color = toast.style.color;
        
        closeButton.addEventListener('click', () => {
          toastContainer.removeChild(toast);
        });
        
        // Append elements
        toast.appendChild(messageElement);
        toast.appendChild(closeButton);
        toastContainer.appendChild(toast);
        
        // Auto remove after duration
        setTimeout(() => {
          if (toast.parentNode === toastContainer) {
            toastContainer.removeChild(toast);
          }
        }, duration);
        
        // Add animation styles if not already present
        if (!document.getElementById('toast-styles')) {
          const style = document.createElement('style');
          style.id = 'toast-styles';
          style.textContent = `
            @keyframes fadeIn {
              from { opacity: 0; transform: translateY(20px); }
              to { opacity: 1; transform: translateY(0); }
            }
          `;
          document.head.appendChild(style);
        }
      };
    }
    
    // Start loading Google Maps
    window.addEventListener('DOMContentLoaded', function() {
      setTimeout(loadGoogleMapsWithKey, 500);
    });
  </script>
  
  <script src="/green/components/toast.js"></script>
  <script src="/green/user-profile.js"></script>
  <script src="/green/client-preview-fixed.js"></script>
  <script src="/green/quote-generator.js"></script>
  <script src="/green/sidebar.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize sidebar
      if (typeof renderSidebar === 'function') {
        renderSidebar('sidebar-container');
      }
      
      // Initialize quote generator
      if (typeof renderQuoteGeneratorPage === 'function') {
        renderQuoteGeneratorPage('quote-generator-container');
      }
    });
  </script>
</body>
</html>