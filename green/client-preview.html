<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quote Preview - Stackr</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <!-- Stripe.js to ensure we're ready for payment processing -->
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* Additional custom styles */
    .quote-header {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
    }
    .quote-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXR0ZXJuIGlkPSJwYXR0ZXJuIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiIHBhdHRlcm5UcmFuc2Zvcm09InJvdGF0ZSgzMCkiPjxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjAzKSIvPjwvcGF0dGVybj48cmVjdCBmaWxsPSJ1cmwoI3BhdHRlcm4pIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIi8+PC9zdmc+');
      opacity: 0.7;
      z-index: 0;
    }
    .quote-header > * {
      position: relative;
      z-index: 1;
    }
    
    /* Card styles */
    .tier-card {
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid transparent;
      position: relative;
    }
    .tier-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 30px -5px rgba(59, 130, 246, 0.15), 0 10px 15px -5px rgba(0, 0, 0, 0.07);
    }
    .tier-card.border-blue-500 {
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
    }
    
    /* Price tag styling */
    .price-tag {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* Recommended badge */
    .recommended-badge {
      position: absolute;
      top: 0;
      right: 0;
      background-color: #3b82f6;
      color: white;
      font-size: 0.75rem;
      font-weight: 500;
      padding: 0.25rem 0.75rem;
      border-bottom-left-radius: 0.5rem;
      transform: translateY(-50%);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    
    /* Progress bar styling */
    .progress-bar {
      height: 6px;
      background-color: #e5e7eb;
      border-radius: 9999px;
      overflow: hidden;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(to right, #3b82f6, #60a5fa);
      transition: width 0.5s ease;
      border-radius: 9999px;
    }
    
    /* Button animations */
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
      }
    }
    
    /* Button effects */
    .select-tier {
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .select-tier::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300%;
      height: 300%;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      transition: transform 0.5s ease, opacity 0.5s ease;
    }
    .select-tier:active::after {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      transition: transform 0s, opacity 0.2s ease;
    }
    
    /* Price tag style */
    .price-tag {
      position: relative;
      display: inline-block;
    }
    .price-tag::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 6px;
      background: rgba(59, 130, 246, 0.15);
      border-radius: 3px;
      z-index: -1;
    }
    
    /* Feature pills style */
    .feature-pill {
      display: inline-flex;
      align-items: center;
      background-color: rgba(59, 130, 246, 0.08);
      padding: 2px 8px;
      border-radius: 12px;
      margin-right: 6px;
      margin-bottom: 6px;
      font-size: 0.75rem;
    }
    
    /* Animations */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
      100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
    }
    
    /* Progress bar */
    .progress-bar {
      height: 4px;
      width: 100%;
      background-color: #e2e8f0;
      border-radius: 2px;
      overflow: hidden;
      position: relative;
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(to right, #3b82f6, #60a5fa);
      width: 0;
      transition: width 1s ease;
      position: absolute;
      top: 0;
      left: 0;
    }
    
    /* Recommended badge */
    .recommended-badge {
      position: absolute;
      top: 0;
      right: 0;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      font-weight: 600;
      font-size: 0.7rem;
      padding: 4px 8px;
      border-bottom-left-radius: 8px;
      box-shadow: -2px 2px 6px rgba(37, 99, 235, 0.2);
      z-index: 10;
    }
    
    /* Mobile-specific adjustments for Samsung ZFold4 */
    @media (max-width: 768px) {
      .quote-container {
        margin: 0;
        padding: 1rem;
      }
      .tier-section {
        flex-direction: column;
      }
      .tier-card {
        width: 100%;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="quote-header text-white p-6">
    <div class="container mx-auto flex justify-between items-center">
      <div>
        <h1 class="text-2xl font-bold" id="business-name">Professional Services</h1>
        <p class="text-sm opacity-80" id="business-tagline">Quality service you can trust</p>
      </div>
      <div class="text-right">
        <p class="text-sm">Quote #<span id="quote-number">QT12345</span></p>
        <p class="text-sm" id="quote-date">April 28, 2025</p>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
      <!-- Quote Header Section -->
      <div class="p-6 border-b">
        <div class="flex flex-wrap justify-between">
          <div class="mb-4 md:mb-0">
            <h2 class="text-xl font-bold text-gray-800">Quote for <span id="customer-name">Client Name</span></h2>
            <p class="text-gray-600" id="quote-description">Bathroom remodeling with premium fixtures</p>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-600">Valid until:</div>
            <div class="font-medium" id="valid-until">May 28, 2025</div>
          </div>
        </div>
      </div>

      <!-- Quote Details Section -->
      <div class="p-6 bg-gray-50 border-b">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-3">Service Details</h3>
            <div class="bg-white p-4 rounded border">
              <div class="mb-2">
                <span class="text-gray-600 text-sm">Service Type:</span>
                <span class="font-medium ml-2" id="service-type">Bathroom Remodel</span>
              </div>
              <div class="mb-2">
                <span class="text-gray-600 text-sm">Location:</span>
                <span class="font-medium ml-2" id="service-location">Denver, CO</span>
              </div>
              <div>
                <span class="text-gray-600 text-sm">Complexity:</span>
                <span class="font-medium ml-2" id="service-complexity">Medium</span>
              </div>
            </div>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-3">Service Provider</h3>
            <div class="bg-white p-4 rounded border">
              <div class="mb-2">
                <span class="text-gray-600 text-sm">Provider:</span>
                <span class="font-medium ml-2" id="provider-name">John Smith</span>
              </div>
              <div class="mb-2">
                <span class="text-gray-600 text-sm">Experience:</span>
                <span class="font-medium ml-2" id="provider-experience">5 years</span>
              </div>
              <div class="flex items-center">
                <span class="text-gray-600 text-sm">Rating:</span>
                <div class="ml-2 flex items-center">
                  <div class="flex text-yellow-400" id="provider-rating">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                  </div>
                  <span class="ml-1 text-sm text-gray-600">(4.8)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pricing Section -->
      <div class="p-6 border-b">
        <h3 class="text-lg font-semibold mb-3">Select Your Package</h3>
        <h4 class="text-sm text-gray-500 mb-4">Choose a package that fits your needs. All quotes include our professional service guarantee.</h4>
        
        <div class="progress-bar mb-5 mt-3">
          <div class="progress-bar-fill" style="width: 0%;"></div>
        </div>
        
        <div class="tier-section flex flex-wrap gap-6 mt-6">
          <!-- Basic Tier -->
          <div class="tier-card flex-1 min-w-[280px] bg-white rounded-lg border border-gray-200 p-6 transition hover:border-blue-200">
            <div class="mb-5">
              <div class="flex justify-between items-center mb-2">
                <h4 class="text-lg font-semibold text-gray-800">Basic</h4>
                <div class="bg-gray-100 text-gray-600 text-xs py-1 px-2 rounded font-medium">STARTER</div>
              </div>
              <p class="text-sm text-gray-600 h-12">Essential service with standard materials and workmanship</p>
            </div>
            <div class="mb-5">
              <span class="price-tag text-3xl font-bold" id="basic-price">$7,492</span>
              <p class="text-xs text-gray-500 mt-1">One-time payment</p>
            </div>
            <div class="mb-6">
              <div class="flex items-center justify-between mb-3">
                <h5 class="font-medium text-sm">What's included:</h5>
                <span class="text-xs text-blue-500">4 features</span>
              </div>
              <ul class="text-sm text-gray-600 space-y-2" id="basic-features">
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Standard fixtures</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Basic materials</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">30-day warranty</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Standard cleanup</span>
                </li>
              </ul>
            </div>
            <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-3 px-4 rounded-lg transition select-tier shadow-sm hover:shadow" data-tier="basic">
              Select Basic
            </button>
          </div>
          
          <!-- Standard Tier -->
          <div class="tier-card flex-1 min-w-[280px] bg-white rounded-lg border-2 border-blue-500 p-6 shadow-md relative transition">
            <div class="recommended-badge">RECOMMENDED</div>
            <div class="mb-5">
              <div class="flex justify-between items-center mb-2">
                <h4 class="text-lg font-semibold text-blue-700">Standard</h4>
                <div class="bg-blue-100 text-blue-700 text-xs py-1 px-2 rounded font-medium">POPULAR</div>
              </div>
              <p class="text-sm text-gray-600 h-12">Enhanced service with quality materials and detailed workmanship</p>
            </div>
            <div class="mb-5">
              <span class="price-tag text-3xl font-bold text-blue-700" id="standard-price">$7,867</span>
              <p class="text-xs text-gray-500 mt-1">One-time payment</p>
            </div>
            <div class="mb-6">
              <div class="flex items-center justify-between mb-3">
                <h5 class="font-medium text-sm">What's included:</h5>
                <span class="text-xs text-blue-500">5 features</span>
              </div>
              <ul class="text-sm text-gray-600 space-y-2" id="standard-features">
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Premium fixtures</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Quality materials</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">90-day warranty</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Priority scheduling</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Thorough cleanup</span>
                </li>
              </ul>
            </div>
            <button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg transition select-tier shadow-sm hover:shadow pulse-animation" data-tier="standard">
              Select Standard
            </button>
          </div>
          
          <!-- Premium Tier -->
          <div class="tier-card flex-1 min-w-[280px] bg-white rounded-lg border border-gray-200 p-6 transition hover:border-blue-200">
            <div class="mb-5">
              <div class="flex justify-between items-center mb-2">
                <h4 class="text-lg font-semibold text-gray-800">Premium</h4>
                <div class="bg-indigo-100 text-indigo-700 text-xs py-1 px-2 rounded font-medium">LUXURY</div>
              </div>
              <p class="text-sm text-gray-600 h-12">Luxury service with superior materials and expert craftsmanship</p>
            </div>
            <div class="mb-5">
              <span class="price-tag text-3xl font-bold" id="premium-price">$8,582</span>
              <p class="text-xs text-gray-500 mt-1">One-time payment</p>
            </div>
            <div class="mb-6">
              <div class="flex items-center justify-between mb-3">
                <h5 class="font-medium text-sm">What's included:</h5>
                <span class="text-xs text-blue-500">7 features</span>
              </div>
              <ul class="text-sm text-gray-600 space-y-2" id="premium-features">
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Luxury fixtures</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Premium materials</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">1-year warranty</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Priority scheduling</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Free follow-up inspection</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Detailed cleanup</span>
                </li>
                <li class="flex items-start">
                  <svg class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                  <span class="mt-0.5">Designer consultation</span>
                </li>
              </ul>
            </div>
            <button class="w-full bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-3 px-4 rounded-lg transition select-tier shadow-sm hover:shadow" data-tier="premium">
              Select Premium
            </button>
          </div>
        </div>
      </div>

      <!-- Quote Breakdown Section -->
      <div class="p-6 hidden fade-in" id="quote-breakdown-section">
        <h3 class="text-lg font-semibold mb-4">Quote Breakdown</h3>
        <div class="bg-white rounded-lg border shadow-sm hover:shadow-md transition-all duration-300">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b bg-gray-50">
                <th class="text-left py-3 px-4 font-semibold text-gray-700">Item Description</th>
                <th class="text-right py-3 px-4 font-semibold text-gray-700">Cost</th>
              </tr>
            </thead>
            <tbody id="breakdown-table-body">
              <tr class="border-b hover:bg-blue-50 transition-colors duration-150">
                <td class="py-3 px-4 text-gray-800">Labor (professional services)</td>
                <td class="text-right py-3 px-4 font-medium" id="breakdown-labor">$5,000.00</td>
              </tr>
              <tr class="border-b hover:bg-blue-50 transition-colors duration-150">
                <td class="py-3 px-4 text-gray-800">Materials</td>
                <td class="text-right py-3 px-4 font-medium" id="breakdown-materials">$2,500.00</td>
              </tr>
              <tr class="border-b bg-gray-50 hover:bg-blue-50 transition-colors duration-150">
                <td class="py-3 px-4 font-medium text-gray-800">Subtotal</td>
                <td class="text-right py-3 px-4 font-medium" id="breakdown-subtotal">$7,500.00</td>
              </tr>
              <tr class="border-b hover:bg-blue-50 transition-colors duration-150">
                <td class="py-3 px-4 text-gray-800">Estimated tax (5%)</td>
                <td class="text-right py-3 px-4 font-medium" id="breakdown-tax">$375.00</td>
              </tr>
              <tr class="bg-blue-50 hover:bg-blue-100 transition-colors duration-150">
                <td class="py-4 px-4 font-bold text-blue-900">Total</td>
                <td class="text-right py-4 px-4 font-bold text-blue-900" id="breakdown-total">$7,875.00</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
          <div class="bg-yellow-50 rounded-lg border border-yellow-200 p-4 hover:shadow-md transition-all duration-300 transform hover:-translate-y-1" id="deposit-notice">
            <div class="flex items-start">
              <div class="flex-shrink-0 bg-yellow-100 rounded-full p-1 animate-pulse">
                <svg class="h-5 w-5 text-yellow-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">Deposit Required</h3>
                <div class="mt-1 text-sm text-yellow-700">
                  <p>A deposit of <span id="deposit-amount" class="font-semibold bg-yellow-100 px-2 py-0.5 rounded">$1,968.75</span> (<span id="deposit-percentage">25%</span>) is required to secure your booking.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="bg-blue-50 rounded-lg border border-blue-200 p-4 hover:shadow-md transition-all duration-300 transform hover:-translate-y-1">
            <div class="flex items-start">
              <div class="flex-shrink-0 bg-blue-100 rounded-full p-1">
                <svg class="h-5 w-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-800">Quote Validity</h3>
                <div class="mt-1 text-sm text-blue-700">
                  <p>This quote is valid until <span class="font-semibold bg-blue-100 px-2 py-0.5 rounded" id="quote-validity-date">May 28, 2025</span>. Please accept before this date.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Section -->
      <div class="p-6 bg-gray-50 flex flex-wrap justify-between items-center">
        <div class="mb-4 md:mb-0">
          <h3 class="text-lg font-semibold">Ready to move forward?</h3>
          <p class="text-sm text-gray-600">Select your preferred package and we'll get started.</p>
        </div>
        <div class="space-x-3">
          <a href="#" class="inline-block bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-50 transition">Request Changes</a>
          <button id="accept-quote" class="inline-block bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 transition" disabled>
            Accept & Proceed
          </button>
        </div>
      </div>
    </div>
    
    <!-- Selected Package Section -->
    <div id="selected-package" class="mt-6 p-6 bg-white border border-gray-200 rounded-lg shadow-md hidden fade-in">
      <h3 class="text-lg font-semibold mb-3">Your Selected Package</h3>
      <div class="bg-blue-50 p-5 rounded-lg border border-blue-200 hover:shadow-lg transition-all duration-300">
        <div class="flex justify-between items-center mb-4">
          <div>
            <h4 class="font-semibold text-lg text-blue-900" id="selected-tier-name">Standard Package</h4>
            <p class="text-gray-600" id="selected-tier-description">Enhanced service with quality materials</p>
          </div>
          <div class="text-right">
            <span class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent" id="selected-tier-price">$7,867</span>
          </div>
        </div>
        <hr class="my-3 border-blue-200">
        <h5 class="font-medium mb-2 text-blue-800">What's included:</h5>
        <ul class="text-sm text-gray-600 space-y-2 mb-4 pl-1" id="selected-tier-features">
          <!-- Features will be inserted here -->
        </ul>
        <div class="mt-4 bg-blue-100 p-3 rounded-md border border-blue-200">
          <p class="italic text-blue-800 text-sm flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            By accepting this quote, you agree to the terms and conditions outlined by the service provider.
          </p>
        </div>
      </div>
      
      <!-- Payment Options Section -->
      <div class="mt-6">
        <h4 class="text-lg font-semibold mb-3 text-blue-900">Payment Options</h4>
        <div class="space-y-4">
          <div class="flex items-center p-4 rounded-lg border payment-option-container ring-2 ring-blue-500 bg-blue-50 transition-all duration-300 transform hover:scale-[1.01] hover:shadow-md">
            <input type="radio" id="payment-deposit" name="payment-option" value="deposit" class="mr-3 h-5 w-5 accent-blue-600" checked>
            <label for="payment-deposit" class="text-gray-800 flex-1 cursor-pointer flex items-center">
              <div class="bg-blue-100 rounded-full p-2 mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <span class="font-medium">Pay <span id="deposit-percent" class="text-blue-700">50%</span> deposit now</span>
                <span class="block text-sm text-gray-500">Amount: <span id="deposit-value" class="font-medium text-blue-700">$3,933.50</span></span>
              </div>
            </label>
          </div>
          <div class="flex items-center p-4 rounded-lg border payment-option-container transition-all duration-300 transform hover:scale-[1.01] hover:shadow-md">
            <input type="radio" id="payment-full" name="payment-option" value="full" class="mr-3 h-5 w-5 accent-blue-600">
            <label for="payment-full" class="text-gray-800 flex-1 cursor-pointer flex items-center">
              <div class="bg-green-100 rounded-full p-2 mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <span class="font-medium">Pay in full now</span>
                <span class="block text-sm text-gray-500">Amount: <span id="full-value" class="font-medium text-green-700">$7,867.00</span></span>
              </div>
            </label>
          </div>
        </div>
      </div>
      
      <div class="flex justify-end mt-8 space-x-4">
        <button class="px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-md transition-all duration-300 hover:shadow-md flex items-center" id="change-package">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
          </svg>
          Change Package
        </button>
        <button class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-all duration-300 hover:shadow-md transform hover:-translate-y-1 flex items-center" id="accept-selected-quote">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Accept Quote
        </button>
        <button class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium flex items-center justify-center rounded-md transition-all duration-300 hover:shadow-md transform hover:-translate-y-1" id="pay-now">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
          Pay Now
        </button>
      </div>
    </div>
    
    <!-- Payment Processing Modal -->
    <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden backdrop-blur-sm">
      <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent">Secure Payment</h3>
          <button id="close-payment-modal" class="text-gray-500 hover:text-gray-700 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <div id="payment-processing" class="text-center py-8">
          <div class="relative mx-auto mb-6">
            <div class="animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600 mx-auto"></div>
            <div class="absolute top-0 left-0 right-0 bottom-0 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-700 font-medium">Establishing secure connection...</p>
          <p class="text-gray-500 text-sm mt-2">This will only take a moment</p>
        </div>
        
        <div id="payment-error" class="hidden fade-in">
          <div class="bg-red-50 border border-red-200 text-red-700 px-5 py-4 rounded-lg mb-6 flex items-start">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-3 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
              <h4 class="font-semibold mb-1">Payment Failed</h4>
              <p id="error-message" class="text-sm">An error occurred while processing your payment.</p>
            </div>
          </div>
          <button id="try-again" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 flex justify-center items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Try Again
          </button>
        </div>
        
        <div id="payment-element-container" class="hidden fade-in">
          <div class="mb-4 p-4 bg-blue-50 rounded-lg border border-blue-100 text-blue-800 text-sm mb-6">
            <div class="flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500 mr-2 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p>Your payment information is securely processed by Stripe. We never store your card details.</p>
            </div>
          </div>
          
          <!-- Stripe Elements will be inserted here -->
          <div id="payment-element" class="mb-6 p-1"></div>
          <button id="submit-payment" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1 flex justify-center items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Complete Payment
          </button>
        </div>
        
        <div id="payment-success" class="hidden text-center py-8 fade-in">
          <div class="rounded-full bg-green-100 h-20 w-20 flex items-center justify-center mx-auto mb-6 animate-bounce-subtle">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
            </svg>
          </div>
          <h4 class="text-2xl font-bold text-gray-800 mb-2">Payment Successful!</h4>
          <p class="text-gray-600 mb-6">Your payment has been processed successfully. A receipt has been sent to your email.</p>
          <button id="close-success" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1">
            Close
          </button>
        </div>
      </div>
    </div>
    
    <style>
      @keyframes bounce-subtle {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
      }
      .animate-bounce-subtle {
        animation: bounce-subtle 2s infinite;
      }
      
      #modal-content.show {
        transform: scale(1);
        opacity: 1;
      }
    </style>

    <!-- Success Message (initially hidden) -->
    <div id="success-message" class="mt-8 p-8 bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl shadow-lg hidden fade-in">
      <div class="flex flex-col md:flex-row items-center">
        <div class="flex-shrink-0 mb-6 md:mb-0">
          <div class="rounded-full bg-green-100 p-5 border-4 border-green-200 animate-bounce-subtle">
            <svg class="h-12 w-12 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
        <div class="ml-0 md:ml-8 text-center md:text-left">
          <h3 class="text-2xl font-bold text-green-800 mb-3">Quote Accepted Successfully!</h3>
          <div class="bg-white rounded-lg p-4 border border-green-200 shadow-sm mb-4">
            <p class="text-gray-700">
              Your quote has been accepted and processed. A confirmation email with all details has been sent to your registered email address.
            </p>
            <p class="mt-2 font-medium text-green-700">
              Reference #: <span id="reference-number">REF-78945</span>
            </p>
          </div>
          <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 justify-center md:justify-start">
            <button class="px-5 py-3 bg-white border border-green-300 text-green-700 font-medium rounded-lg hover:bg-green-50 transition-all duration-300 shadow-sm flex items-center justify-center" id="download-quote-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
              Download Quote
            </button>
            <button class="px-5 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium rounded-lg transition-all duration-300 shadow-md transform hover:-translate-y-1 flex items-center justify-center" id="view-details-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              View Details
            </button>
          </div>
        </div>
      </div>
      
      <div class="mt-6 bg-white rounded-lg border border-green-200 p-4 shadow-sm">
        <h4 class="font-medium text-gray-800 mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          What happens next?
        </h4>
        <ol class="text-sm text-gray-600 space-y-2 pl-8 list-decimal">
          <li>Our team will contact you within 24 hours to confirm details.</li>
          <li>You'll receive a detailed work schedule and timeline.</li>
          <li>Materials will be ordered and work will begin based on the agreed schedule.</li>
        </ol>
      </div>
    </div>
  </div>

  <script type="module">
    // Load quote data from URL parameters
    const quoteParams = new URLSearchParams(window.location.search);
    const quoteId = quoteParams.get('id') || 'demo';
    const userId = quoteParams.get('userId') || '';
    
    // Reference to store the actual quote data that will be fetched from the server
    let quoteData = null;
    
    // Function to fetch quote data from the server
    async function fetchQuoteData() {
      // Show loading state
      document.getElementById('loading-indicator').classList.remove('hidden');
      
      try {
        // If demo mode or no quoteId/userId, use demo data
        if (quoteId === 'demo' || !userId) {
          console.log('Using demo quote data');
          return {
            id: "QT12345",
            businessName: "Stackr Remodeling",
            businessTagline: "Quality renovations you can trust",
            date: new Date().toLocaleDateString(),
            validUntil: new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString(),
            customerName: "David Thompson",
            description: "Complete bathroom renovation with modern fixtures",
            serviceType: "Bathroom Remodel",
            serviceLocation: "Denver, CO",
            serviceComplexity: "Medium",
            providerName: "John Smith",
            providerExperience: "5 years",
            providerRating: 4.8,
            tierOptions: {
              basic: {
                name: "Basic",
                price: 7492,
                features: [
                  "Standard fixtures",
                  "Basic materials",
                  "30-day warranty",
                  "Standard cleanup"
                ]
              },
              standard: {
                name: "Standard",
                price: 7867,
                features: [
                  "Premium fixtures",
                  "Quality materials",
                  "90-day warranty",
                  "Priority scheduling",
                  "Thorough cleanup"
                ]
              },
              premium: {
                name: "Premium",
                price: 8582,
                features: [
                  "Luxury fixtures",
                  "Premium materials",
                  "1-year warranty", 
                  "Priority scheduling",
                  "Free follow-up inspection",
                  "Detailed cleanup",
                  "Designer consultation"
                ]
              }
            },
            breakdown: {
              labor: 5000,
              materials: 2500,
              taxRate: 0.05,
              depositPercent: 25
            },
            depositRequired: true,
            depositPercent: 25,
            reference: "REF-78945"
          };
        }
        
        // Fetch quote data from the server API
        console.log(`Fetching quote data for ID: ${quoteId}, User ID: ${userId}`);
        const response = await fetch(`/api/quotes/${quoteId}?userId=${userId}`);
        
        if (!response.ok) {
          throw new Error(`Error fetching quote: ${response.status} ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('Quote data received:', data);
        
        // Return the actual quote data 
        return data.quote || null;
      } catch (error) {
        console.error('Error fetching quote data:', error);
        
        // Show error message
        const errorContainer = document.getElementById('error-container');
        if (errorContainer) {
          errorContainer.textContent = `Error loading quote: ${error.message}`;
          errorContainer.classList.remove('hidden');
        }
        
        // Fallback to demo data in case of error
        return null;
      } finally {
        // Hide loading indicator
        document.getElementById('loading-indicator').classList.add('hidden');
      }
    }
    
    // Initialize page
    async function initPage() {
      // Add loading indicator
      if (!document.getElementById('loading-indicator')) {
        const loadingIndicator = document.createElement('div');
        loadingIndicator.id = 'loading-indicator';
        loadingIndicator.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden';
        loadingIndicator.innerHTML = `
          <div class="bg-white p-6 rounded-lg shadow-xl flex flex-col items-center">
            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="text-gray-700 font-medium">Loading quote data...</p>
          </div>
        `;
        document.body.appendChild(loadingIndicator);
      }
      
      // Add error container if it doesn't exist
      if (!document.getElementById('error-container')) {
        const errorContainer = document.createElement('div');
        errorContainer.id = 'error-container';
        errorContainer.className = 'bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded fixed top-4 right-4 hidden z-50';
        document.body.appendChild(errorContainer);
      }
      
      // Fetch quote data from the server
      const fetchedQuote = await fetchQuoteData();
      
      // If we couldn't fetch the data, use demo data as fallback
      const quoteData = fetchedQuote || {
        id: "QT12345",
        businessName: "Stackr Remodeling",
        businessTagline: "Quality renovations you can trust",
        date: new Date().toLocaleDateString(),
        validUntil: new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString(),
        customerName: "David Thompson",
        description: "Complete bathroom renovation with modern fixtures",
        serviceType: "Bathroom Remodel",
        serviceLocation: "Denver, CO",
        serviceComplexity: "Medium",
        providerName: "John Smith",
        providerExperience: "5 years",
        providerRating: 4.8,
        tierOptions: {
          basic: {
            name: "Basic",
            price: 7492,
            features: [
              "Standard fixtures",
              "Basic materials",
              "30-day warranty",
              "Standard cleanup"
            ]
          },
          standard: {
            name: "Standard",
            price: 7867,
            features: [
              "Premium fixtures",
              "Quality materials",
              "90-day warranty",
              "Priority scheduling",
              "Thorough cleanup"
            ]
          },
          premium: {
            name: "Premium",
            price: 8582,
            features: [
              "Luxury fixtures",
              "Premium materials",
              "1-year warranty",
              "Priority scheduling",
              "Free follow-up inspection",
              "Detailed cleanup",
              "Designer consultation"
            ]
          }
        },
        breakdown: {
          labor: 5000,
          materials: 2500,
          taxRate: 0.05
        },
        depositRequired: true,
        depositPercent: 25
      };
      
      // Store the quote data globally for other functions to use
      window.demoQuote = quoteData;
      
      // Determine which object property contains the tiers data
      // The API might return tierOptions instead of tiers
      const tiersData = quoteData.tierOptions || quoteData.tiers;
      if (!tiersData) {
        console.error('No tier data found in quote');
        return;
      }
      
      // Ensure quote data has the proper structure
      quoteData.tiers = tiersData;
      
      // Set basic quote information
      document.getElementById('business-name').textContent = quoteData.businessName || 'Stackr Services';
      document.getElementById('business-tagline').textContent = quoteData.businessTagline || 'Professional services you can trust';
      document.getElementById('quote-number').textContent = quoteData.id;
      document.getElementById('quote-date').textContent = quoteData.date || new Date().toLocaleDateString();
      document.getElementById('valid-until').textContent = quoteData.validUntil || new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString();
      document.getElementById('customer-name').textContent = quoteData.customerName || 'Valued Customer';
      document.getElementById('quote-description').textContent = quoteData.description || 'Professional services';
      
      // Set service details 
      document.getElementById('service-type').textContent = quoteData.serviceType || quoteData.jobType || 'Professional Service';
      document.getElementById('service-location').textContent = quoteData.serviceLocation || quoteData.location || 'On Location';
      document.getElementById('service-complexity').textContent = quoteData.serviceComplexity || quoteData.complexity || 'Standard';
      
      // Set provider details
      document.getElementById('provider-name').textContent = quoteData.providerName || 'Professional Provider';
      document.getElementById('provider-experience').textContent = quoteData.providerExperience || quoteData.experienceYears + ' years' || 'Experienced';
      
      // Set pricing options - needs to handle both API structures
      document.getElementById('basic-price').textContent = `$${(tiersData.basic.price).toLocaleString()}`;
      document.getElementById('standard-price').textContent = `$${(tiersData.standard.price).toLocaleString()}`;
      document.getElementById('premium-price').textContent = `$${(tiersData.premium.price).toLocaleString()}`;
      
      // Function to handle features array for any tier
      const renderFeaturesList = (tier, targetId) => {
        const features = tier.features || [];
        document.getElementById(targetId).innerHTML = features.map(feature => `
          <li class="flex items-start">
            <svg class="h-5 w-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span>${feature}</span>
          </li>
        `).join('');
      };
      
      // Set features for each tier
      renderFeaturesList(tiersData.basic, 'basic-features');
      renderFeaturesList(tiersData.standard, 'standard-features');  
      renderFeaturesList(tiersData.premium, 'premium-features');
      
      // Set reference number if available
      if (quoteData.reference) {
        document.getElementById('reference-number').textContent = quoteData.reference;
      }
      
      // Initialize quote breakdown (hidden initially)
      updateBreakdown('standard'); // Default to standard tier
    }
    
    // Update quote breakdown based on selected tier
    function updateBreakdown(tier) {
      // Get the quote data from the global variable
      const quoteData = window.demoQuote;
      
      // Handle both data structures (tierOptions or tiers)
      const tierData = quoteData.tiers[tier];
      
      // Check if breakdown information exists in the quote
      const breakdownData = quoteData.breakdown || {};
      
      // Get price from tier data
      const price = tierData.price;
      
      // Get labor and materials costs
      const labor = breakdownData.labor || tierData.laborCost || 0;
      const materials = breakdownData.materials || tierData.materialCost || 0;
      
      // Calculate subtotal (either use the one from the API or calculate it)
      const subtotal = tierData.subtotal || price;
      
      // Get tax rate from quote or use default
      const taxRate = breakdownData.taxRate || quoteData.taxRate || 0.05;
      
      // Calculate tax
      const tax = tierData.tax || (subtotal * taxRate);
      
      // Calculate total
      const total = tierData.total || (subtotal + tax);
      
      // Determine deposit info
      const depositRequired = quoteData.depositRequired !== undefined ? quoteData.depositRequired : true;
      const depositPercent = quoteData.depositPercent || breakdownData.depositPercent || (price > 2000 ? 25 : 50);
      const deposit = depositRequired ? (total * (depositPercent / 100)) : 0;
      
      // Update the breakdown display
      document.getElementById('breakdown-labor').textContent = `$${labor.toLocaleString()}`;
      document.getElementById('breakdown-materials').textContent = `$${materials.toLocaleString()}`;
      document.getElementById('breakdown-subtotal').textContent = `$${subtotal.toLocaleString()}`;
      document.getElementById('breakdown-tax').textContent = `$${tax.toLocaleString()}`;
      document.getElementById('breakdown-total').textContent = `$${total.toLocaleString()}`;
      
      // Update deposit information
      const depositText = depositRequired 
        ? `$${deposit.toLocaleString()} (${depositPercent}%)`
        : 'Not required';
      document.getElementById('deposit-amount').textContent = depositText;
      
      // Show the breakdown section
      document.getElementById('quote-breakdown-section').classList.remove('hidden');
    }
    
    // Set up event listeners
    // Update the selected package display
    function updateSelectedPackage(tier) {
      // Get the quote data from the global variable
      const quoteData = window.demoQuote;
      
      // Handle both data structures (tierOptions or tiers)
      const tierData = quoteData.tiers[tier];
      
      // Define display name
      const displayName = tierData.name || (tier.charAt(0).toUpperCase() + tier.slice(1) + ' Package');
      
      // Update name, description and price
      document.getElementById('selected-tier-name').textContent = displayName;
      document.getElementById('selected-tier-description').textContent = tierData.description || getTierDescription(tier);
      document.getElementById('selected-tier-price').textContent = `$${tierData.price.toLocaleString()}`;
      
      // Update features list
      const features = tierData.features || [];
      document.getElementById('selected-tier-features').innerHTML = features.map(feature => `
        <li class="flex items-start">
          <svg class="h-5 w-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          <span>${feature}</span>
        </li>
      `).join('');
      
      // Update deposit information
      updatePaymentAmount();
    }
    
    // Get a description for each tier
    function getTierDescription(tier) {
      const descriptions = {
        basic: 'Essential service with standard materials and workmanship',
        standard: 'Enhanced service with quality materials and detailed workmanship',
        premium: 'Premium service with luxury materials and expert craftsmanship'
      };
      return descriptions[tier];
    }
    
    // Update payment amount based on selected option
    function updatePaymentAmount() {
      // Get the quote data from the global variable
      const quoteData = window.demoQuote;
      
      // Get the selected tier
      const selectedTier = getCurrentSelectedTier();
      const tierData = quoteData.tiers[selectedTier];
      
      // Get price from the selected tier
      const price = tierData.price;
      
      // Get payment option selection
      const isFullPayment = document.getElementById('payment-full').checked;
      const payNowBtn = document.getElementById('pay-now');
      
      // Determine deposit percentage based on price and quote data
      const depositRequired = quoteData.depositRequired !== undefined ? quoteData.depositRequired : true;
      let depositPercent = quoteData.depositPercent || (price > 2000 ? 25 : 50);
      
      // If deposit is not required, default to full payment
      if (!depositRequired) {
        document.getElementById('payment-full').checked = true;
      }
      
      // Update deposit percent display
      document.getElementById('deposit-percent').textContent = `${depositPercent}%`;
      
      // Calculate deposit amount
      const depositAmount = price * (depositPercent / 100);
      
      // Update deposit value display
      document.getElementById('deposit-value').textContent = `$${depositAmount.toLocaleString()}`;
      
      // Remove any previous highlight classes
      document.querySelectorAll('.payment-option-container').forEach(container => {
        container.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-50');
      });
      
      // Highlight the selected option
      const selectedOption = document.querySelector('input[name="payment-option"]:checked').value;
      const selectedContainer = document.querySelector(`input[value="${selectedOption}"]`).closest('.payment-option-container');
      if (selectedContainer) {
        selectedContainer.classList.add('ring-2', 'ring-blue-500', 'bg-blue-50');
      }
      
      // Update payment button text based on selection
      if (selectedOption === 'deposit' && depositRequired) {
        payNowBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>Pay Deposit ($${depositAmount.toLocaleString()})`;
      } else {
        payNowBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>Pay Full ($${price.toLocaleString()})`;
      }
      
      // Add pulse animation to the payment button
      payNowBtn.classList.add('pulse-animation');
      
      // Remove the animation after 2 seconds
      setTimeout(() => {
        payNowBtn.classList.remove('pulse-animation');
      }, 2000);
      
      // If deposit is not required, disable the deposit option
      if (!depositRequired) {
        document.getElementById('payment-deposit').disabled = true;
        document.getElementById('deposit-option-label').classList.add('opacity-50');
      } else {
        document.getElementById('payment-deposit').disabled = false;
        document.getElementById('deposit-option-label').classList.remove('opacity-50');
      }
    }
    
    // Get the currently selected tier
    function getCurrentSelectedTier() {
      const selectedButton = document.querySelector('.select-tier.bg-blue-500');
      return selectedButton ? selectedButton.dataset.tier : 'standard';
    }
    
    // Process payment with Stripe
    async function processPayment() {
      // Show payment modal with animation
      const paymentModal = document.getElementById('payment-modal');
      const modalContent = document.getElementById('modal-content');
      
      // Show the modal
      paymentModal.classList.remove('hidden');
      
      // Trigger reflow to make the animation work
      void modalContent.offsetWidth;
      
      // Add show class to animate in
      setTimeout(() => {
        modalContent.classList.add('show');
      }, 10);
      
      // Show processing state
      document.getElementById('payment-processing').classList.remove('hidden');
      document.getElementById('payment-error').classList.add('hidden');
      document.getElementById('payment-element-container').classList.add('hidden');
      document.getElementById('payment-success').classList.add('hidden');
      
      try {
        // Get payment details
        const selectedTier = getCurrentSelectedTier();
        const price = demoQuote.tiers[selectedTier].price;
        const isFullPayment = document.getElementById('payment-full').checked;
        const depositPercent = price > 2000 ? 25 : 50;
        const paymentAmount = isFullPayment ? price : price * (depositPercent / 100);
        
        // Create payment intent
        const response = await fetch('/api/create-payment-intent', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            amount: paymentAmount,
            invoiceId: demoQuote.id,
            customerName: demoQuote.customerName,
            description: `${demoQuote.description} - ${selectedTier} tier`,
            tier: selectedTier
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        // If we're in development mode with a mock client secret
        if (data.isDevelopment) {
          console.log('Development mode detected, simulating payment...');
          
          // Hide processing, show success after a delay to simulate payment
          setTimeout(() => {
            document.getElementById('payment-processing').classList.add('hidden');
            document.getElementById('payment-success').classList.remove('hidden');
          }, 1500);
          
          return;
        }
        
        // Initialize Stripe
        const stripe = Stripe(data.stripePublicKey || 'pk_test_TYooMQauvdEDq54NiTphI7jx');
        
        // Show payment element
        document.getElementById('payment-processing').classList.add('hidden');
        document.getElementById('payment-element-container').classList.remove('hidden');
        
        // Set up Stripe Elements
        const elements = stripe.elements({
          clientSecret: data.clientSecret
        });
        
        // Create payment element
        const paymentElement = elements.create('payment');
        paymentElement.mount('#payment-element');
        
        // Handle payment submission
        document.getElementById('submit-payment').addEventListener('click', async function() {
          try {
            const { error } = await stripe.confirmPayment({
              elements,
              confirmParams: {
                return_url: window.location.origin + '/payment-success.html',
              },
              redirect: 'if_required'
            });
            
            if (error) {
              // Show error
              document.getElementById('error-message').textContent = error.message;
              document.getElementById('payment-element-container').classList.add('hidden');
              document.getElementById('payment-error').classList.remove('hidden');
            } else {
              // Show success
              document.getElementById('payment-element-container').classList.add('hidden');
              document.getElementById('payment-success').classList.remove('hidden');
            }
          } catch (error) {
            console.error('Payment confirmation error:', error);
            document.getElementById('error-message').textContent = 'An unexpected error occurred.';
            document.getElementById('payment-element-container').classList.add('hidden');
            document.getElementById('payment-error').classList.remove('hidden');
          }
        });
      } catch (error) {
        console.error('Payment processing error:', error);
        document.getElementById('error-message').textContent = error.message;
        document.getElementById('payment-processing').classList.add('hidden');
        document.getElementById('payment-error').classList.remove('hidden');
      }
    }
    
    function setupListeners() {
      // Set up tier selection
      const tierButtons = document.querySelectorAll('.select-tier');
      tierButtons.forEach(button => {
        button.addEventListener('click', function() {
          const tier = this.dataset.tier;
          
          // Reset all tier cards and buttons
          document.querySelectorAll('.tier-card').forEach(card => {
            card.classList.remove('border-2', 'border-blue-500', 'shadow-md');
            card.classList.add('border', 'border-gray-200');
          });
          
          document.querySelectorAll('.select-tier').forEach(btn => {
            btn.classList.remove('bg-blue-500', 'hover:bg-blue-600', 'text-white');
            btn.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-800');
          });
          
          // Highlight selected tier
          const selectedCard = this.closest('.tier-card');
          selectedCard.classList.remove('border', 'border-gray-200');
          selectedCard.classList.add('border-2', 'border-blue-500', 'shadow-md');
          
          this.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-800');
          this.classList.add('bg-blue-500', 'hover:bg-blue-600', 'text-white');
          
          // Update breakdown
          updateBreakdown(tier);
          
          // Update selected package display
          updateSelectedPackage(tier);
          
          // Enable accept button
          const acceptButton = document.getElementById('accept-quote');
          acceptButton.removeAttribute('disabled');
          acceptButton.classList.add('pulse-animation');
          
          // Update progress bar to show completion of package selection
          document.querySelector('.progress-bar-fill').style.width = '33%';
        });
      });
      
      // Set up accept button
      document.getElementById('accept-quote').addEventListener('click', function() {
        // Show selected package instead of success message
        document.getElementById('selected-package').classList.remove('hidden');
        
        // Hide the pricing tiers and breakdown sections
        document.querySelector('.tier-section').classList.add('hidden');
        document.getElementById('quote-breakdown-section').classList.add('hidden');
        
        // Hide the action section with the Accept button
        this.closest('.p-6').classList.add('hidden');
        
        // Update progress bar to next step
        document.querySelector('.progress-bar-fill').style.width = '66%';
        
        // Remove the pulse animation from accept button
        this.classList.remove('pulse-animation');
        
        // Add pulse to pay now button
        setTimeout(() => {
          document.getElementById('pay-now').classList.add('pulse-animation');
        }, 500);
        
        // Scroll to selected package
        document.getElementById('selected-package').scrollIntoView({ behavior: 'smooth' });
      });
      
      // Set up payment option radio buttons
      document.getElementById('payment-deposit').addEventListener('change', updatePaymentAmount);
      document.getElementById('payment-full').addEventListener('change', updatePaymentAmount);
      
      // Set up change package button
      document.getElementById('change-package').addEventListener('click', function() {
        // Show the pricing tiers and breakdown sections
        document.querySelector('.tier-section').classList.remove('hidden');
        document.getElementById('quote-breakdown-section').classList.remove('hidden');
        
        // Show the action section with the Accept button
        document.querySelector('.p-6.bg-gray-50').classList.remove('hidden');
        
        // Hide selected package
        document.getElementById('selected-package').classList.add('hidden');
        
        // Reset progress bar
        document.querySelector('.progress-bar-fill').style.width = '0%';
        
        // Reset pay now button animation
        document.getElementById('pay-now').classList.remove('pulse-animation');
      });
      
      // Set up pay now button
      document.getElementById('pay-now').addEventListener('click', processPayment);
      
      // Set up close payment modal button
      document.getElementById('close-payment-modal').addEventListener('click', function() {
        document.getElementById('payment-modal').classList.add('hidden');
      });
      
      // Set up try again button
      document.getElementById('try-again').addEventListener('click', processPayment);
      
      // Set up close success button
      document.getElementById('close-success').addEventListener('click', function() {
        document.getElementById('payment-modal').classList.add('hidden');
        // Show success message for the quote
        document.getElementById('success-message').classList.remove('hidden');
        // Hide selected package
        document.getElementById('selected-package').classList.add('hidden');
        // Complete progress bar
        document.querySelector('.progress-bar-fill').style.width = '100%';
        // Scroll to success message
        document.getElementById('success-message').scrollIntoView({ behavior: 'smooth' });
      });
      
      // Set up accept selected quote button
      document.getElementById('accept-selected-quote').addEventListener('click', function() {
        // Show success message
        document.getElementById('success-message').classList.remove('hidden');
        // Hide selected package
        document.getElementById('selected-package').classList.add('hidden');
        // Complete progress bar
        document.querySelector('.progress-bar-fill').style.width = '100%';
        // Scroll to success message
        document.getElementById('success-message').scrollIntoView({ behavior: 'smooth' });
      });
      
      // Set up view details button
      document.getElementById('view-details-btn').addEventListener('click', function() {
        // In a real app, this would navigate to a details page
        alert('In a production app, this would navigate to the order details page.');
      });
    }
    
    // Add hover effects to tier cards
    function setupTierCardHover() {
      document.querySelectorAll('.tier-card').forEach(card => {
        card.addEventListener('mouseover', function() {
          if (!this.classList.contains('border-blue-500')) {
            this.classList.remove('border-gray-200');
            this.classList.add('border-blue-300', 'shadow-md');
            
            // Subtle scale effect
            this.style.transform = 'scale(1.01)';
          }
        });
        
        card.addEventListener('mouseout', function() {
          if (!this.classList.contains('border-blue-500')) {
            this.classList.remove('border-blue-300', 'shadow-md');
            this.classList.add('border-gray-200');
            
            // Reset scale
            this.style.transform = 'scale(1)';
          }
        });
      });
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      initPage();
      setupListeners();
      setupTierCardHover();
    });
  </script>
</body>
</html>